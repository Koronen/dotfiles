#!/usr/bin/env sh

set -e

root=`dirname $0`/..
root=$(cd $root && pwd)

# Check for git dependency
if ! which git >/dev/null 2>&1; then
    if ! sudo apt-get install -y git >/dev/null 2>&1; then
        echo "[-] Missing dependency: git" >&2
        exit 1
    fi
fi

# Clone prezto
test -d "${ZDOTDIR:-$HOME}/.zprezto" || git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"

# Check for fasd dependency
if ! which fasd >/dev/null 2>&1; then
    echo "[-] Missing dependency: fasd" >&2
    echo "[-] See https://github.com/clvv/fasd for installation instructions." >&2
fi

# Symlink files
mkdir -p $HOME/.weechat
dotfiles="ackrc bash_profile bashrc dircolors gemrc gitattributes gitconfig gitignore hgrc inputrc irbrc profile screenrc tmux.conf vimrc zshenv zlogin zlogout zpreztorc zshrc weechat/alias.conf weechat/logger.conf weechat/weechat.conf weechat/wg.conf"
for dotfile in $dotfiles; do
    ln -sf "$root/$dotfile" "$HOME/.$dotfile"
done
unset dotfiles

# Symlink directories
dotdirs="bashrc.d i3 vim zsh weechat/lua weechat/perl weechat/python weechat/ruby weechat/tcl"
for dotdir in $dotdirs; do
    test -d "$HOME/.$dotdir" || ln -sf "$root/$dotdir" "$HOME/.$dotdir"
done
unset dotdirs

unset root

git submodule update --init
